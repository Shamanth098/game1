<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>2048 — Smooth Dark</title>
<style>
  :root{
    --bg:#0f1113;
    --panel:#1f2328;
    --cell:#2b2f36;
    --accent:#f7c948;
    --gap:14px;
    --board-max:520px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:18px;
    padding:20px;
    background: linear-gradient(180deg,#0f1113,#16181b);
    color:#fff;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  header{width:100%;max-width:1100px;display:flex;align-items:center;justify-content:space-between;gap:12px}
  .brand {display:flex;flex-direction:column;align-items:flex-start;}
  h1{margin:0;font-size:20px;color:var(--accent);letter-spacing:0.6px}
  .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .score-box{background:rgba(255,255,255,0.04);padding:8px 12px;border-radius:10px;font-weight:700;min-width:86px;text-align:center}
  .btn{background:linear-gradient(90deg,#2a72d6,#1f4fb0);border:0;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit}
  .board-wrap{display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap;justify-content:center;width:100%;max-width:1100px}
  #board {
    width: min(92vmin, var(--board-max));
    aspect-ratio: 1/1;
    background: var(--panel);
    padding: calc(var(--gap));
    border-radius: 14px;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--gap);
    box-shadow: 0 14px 36px rgba(2,6,23,0.6);
    user-select:none;
    touch-action: manipulation;
    position: relative;
  }
  .cell { background: var(--cell); border-radius: 10px; }
  .tile {
    position:absolute;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:800;
    border-radius:10px;
    box-shadow: 0 10px 26px rgba(2,6,23,0.45);
    transition: left 180ms ease, top 180ms ease;
    will-change: left, top;
    user-select:none;
  }
  .tile.pop { animation: pop .18s cubic-bezier(.2,.9,.3,1) forwards; }
  .tile.mergePop { animation: mergePop .22s cubic-bezier(.2,.9,.3,1) forwards; }
  @keyframes pop { from{ transform: scale(.3); opacity:.2 } to{ transform: scale(1); opacity:1 } }
  @keyframes mergePop { 0%{ transform: scale(1); } 50%{ transform: scale(1.18); } 100%{ transform: scale(1); } }
  .v2  { background: #eee4da; color: #776e65; font-size: clamp(18px, 4.4vmin, 36px); }
  .v4  { background: #ede0c8; color: #776e65; font-size: clamp(18px, 4.4vmin, 36px); }
  .v8  { background: #f2b179; color: #fff; font-size: clamp(18px, 4.2vmin, 34px); }
  .v16 { background: #f59563; color: #fff; font-size: clamp(16px, 3.8vmin, 32px); }
  .v32 { background: #f67c5f; color: #fff; font-size: clamp(16px, 3.6vmin, 30px); }
  .v64 { background: #f65e3b; color: #fff; font-size: clamp(16px, 3.4vmin, 28px); }
  .v128{ background: #edcf72; color: #111; font-size: clamp(14px, 3.2vmin, 26px); }
  .v256{ background: #edcc61; color: #111; font-size: clamp(14px, 3.0vmin, 24px); }
  .v512{ background: #edc850; color: #111; font-size: clamp(14px, 2.8vmin, 22px); }
  .v1024{background: #edc53f; color: #111; font-size: clamp(12px, 2.6vmin, 20px); }
  .v2048{background: #edc22e; color: #111; font-size: clamp(12px, 2.4vmin, 18px); }
  .confetti { position:fixed; width:10px; height:8px; border-radius:2px; pointer-events:none; z-index:9999; }
</style>
</head>
<body>
<header>
  <div class="brand">
    <h1>2048 — Classic Smooth</h1>
    <div style="color:rgba(255,255,255,0.6);font-size:13px">Smooth sliding · responsive · saved best</div>
  </div>
  <div class="controls">
    <div class="score-box">Score<br><span id="score">0</span></div>
    <div class="score-box">Best<br><span id="best">0</span></div>
    <button id="mainBtn" class="btn ghost">Main Menu</button>
    <button id="resetBtn" class="btn">Reset</button>
  </div>
</header>
<div class="board-wrap"><div id="board"></div></div>
<script>
const SIZE=4,board=document.getElementById("board"),scoreEl=document.getElementById("score"),bestEl=document.getElementById("best");
let score=0,best=parseInt(localStorage.getItem("2048_best")||"0"),first512=false,tiles={},nextId=1,tileEls={};
bestEl.textContent=best;
for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++){let cell=document.createElement("div");cell.className="cell";board.appendChild(cell);}
function posRect(r,c){let idx=r*SIZE+c,cell=board.children[idx],b=board.getBoundingClientRect(),cr=cell.getBoundingClientRect();return{l:cr.left-b.left,t:cr.top-b.top,w:cr.width,h:cr.height};}
function spawn(v,pos){let id=nextId++;tiles[id]={id,value:v,r:pos.r,c:pos.c,merged:false};let el=document.createElement("div");el.className="tile v"+v;el.textContent=v;board.appendChild(el);tileEls[id]=el;place(id,true);}
function place(id,now){let el=tileEls[id];if(!el)return;let t=tiles[id],p=posRect(t.r,t.c);if(now)el.style.transition="none";el.style.left=p.l+"px";el.style.top=p.t+"px";el.style.width=p.w+"px";el.style.height=p.h+"px";if(now){el.offsetHeight;el.style.transition="left 180ms ease, top 180ms ease";}}
function reset(){Object.keys(tileEls).forEach(remove);tiles={};nextId=1;score=0;scoreEl.textContent=score;first512=false;spawn(Math.random()<0.9?2:4,{r:0,c:0});spawn(Math.random()<0.9?2:4,{r:SIZE-1,c:SIZE-1});Object.keys(tiles).forEach(id=>place(id,true));}
function remove(id){let el=tileEls[id];if(el)el.remove();delete tileEls[id];delete tiles[id];}
function move(dir){let vec={left:[0,-1],right:[0,1],up:[-1,0],down:[1,0]}[dir],order=[];
if(dir==="left"){for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++)order.push([r,c]);}
if(dir==="right"){for(let r=0;r<SIZE;r++)for(let c=SIZE-1;c>=0;c--)order.push([r,c]);}
if(dir==="up"){for(let c=0;c<SIZE;c++)for(let r=0;r<SIZE;r++)order.push([r,c]);}
if(dir==="down"){for(let c=0;c<SIZE;c++)for(let r=SIZE-1;r>=0;r--)order.push([r,c]);}
let moved=false;Object.values(tiles).forEach(t=>t.merged=false);
order.forEach(([r,c])=>{let t=Object.values(tiles).find(x=>x.r===r&&x.c===c);if(!t)return;let nr=r,nc=c;while(nr+vec[0]>=0&&nr+vec[0]<SIZE&&nc+vec[1]>=0&&nc+vec[1]<SIZE&&!Object.values(tiles).some(x=>x.r===nr+vec[0]&&x.c===nc+vec[1])){nr+=vec[0];nc+=vec[1];}
let target=Object.values(tiles).find(x=>x.r===nr+vec[0]&&x.c===nc+vec[1]);
if(target&&target.value===t.value&&!target.merged&&!t.merged){t.r=target.r;t.c=target.c;place(t.id);remove(t.id);target.value*=2;target.merged=true;score+=target.value;if(score>best){best=score;localStorage.setItem("2048_best",best);}let el=tileEls[target.id];el.textContent=target.value;el.className="tile v"+target.value+" mergePop";if(!first512&&target.value>=512){first512=true;confetti();}moved=true;}
else if(nr!==r||nc!==c){t.r=nr;t.c=nc;place(t.id);moved=true;}});
if(moved){let empt=[];for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++)if(!Object.values(tiles).some(x=>x.r===r&&x.c===c))empt.push({r,c});if(empt.length){let pos=empt[Math.random()*empt.length|0];spawn(Math.random()<0.9?2:4,pos);}scoreEl.textContent=score;bestEl.textContent=best;if(!canMove())setTimeout(()=>alert("Game Over"),100);}}
function canMove(){for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++){if(!Object.values(tiles).some(x=>x.r===r&&x.c===c))return true;let t=Object.values(tiles).find(x=>x.r===r&&x.c===c);for(let [dr,dc] of[[0,1],[1,0]]){let n=Object.values(tiles).find(x=>x.r===r+dr&&x.c===c+dc);if(n&&n.value===t.value)return true;}}return false;}
function confetti(){for(let i=0;i<40;i++){let e=document.createElement("div");e.className="confetti";e.style.left=(50+(Math.random()-0.5)*40)+"vw";e.style.top=(20+Math.random()*20)+"vh";e.style.background=`hsl(${Math.random()*360} 80% 60%)`;document.body.appendChild(e);e.animate([{transform:"translateY(0px)"},{transform:`translate(${(Math.random()-0.5)*400}px, ${400+Math.random()*200}px)`}],{duration:900+Math.random()*900});setTimeout(()=>e.remove(),2e3);}}
document.getElementById("resetBtn").onclick=reset;
document.getElementById("mainBtn").onclick=()=>location.href="index.html";
window.onkeydown=e=>{if(e.key==="ArrowLeft")move("left");if(e.key==="ArrowRight")move("right");if(e.key==="ArrowUp")move("up");if(e.key==="ArrowDown")move("down");};
document.addEventListener("contextmenu",e=>e.preventDefault());
reset();
</script>
</body>
</html>
